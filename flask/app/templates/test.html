<!-- Written by Phicharaya Khotmani -->
<!-- 650510631 -->

<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title> NoVex </title>
        <link rel="icon" type="image/png" href="static/img/Novel_Vortex-icon.png">


        <!-- CSS -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/signup.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">


        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
        rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
                
        <!-- Boxicons CSS -->
        <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css" />
                        
    </head>

    <body style="background-color: #FFF7F1;">

        <div class="container">

            <nav class="navbar">

                    <div class="header">

                        <div>

                            <div>
                                <a href="{{ url_for('home_page') }}" class="logo" style="text-decoration: none;">
                                    <img src="static/img/book.png" width="40" height="40" viewBox="0 0 40 40" fill="none">
                                    Novel <br> Vortex
                                </a>
                            </div>

                        </div>

                        <div>

                            {% if not current_user.is_authenticated %}

                                <a href="#" style="text-decoration: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg"  fill="currentColor" class="bi bi-search" viewBox="0 0 16 16" id="search-icon">
                                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                                    </svg>
                                </a>
            
                                <a href="#" style="text-decoration: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg"  fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16" id="shelf-icon">
                                        <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"/>
                                    </svg>
                                </a>
            
                                <a href="#" id="writer" style="text-decoration: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg"  fill="currentColor" class="bi bi-pen-fill" viewBox="0 0 16 16" id="write-icon">
                                        <path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001"/>
                                    </svg>
                                </a>
            
                                
                                <a href="{{ url_for('login_page') }}"> เข้าสู่ระบบ / ลงทะเบียน </a>

                            {% else %}

                                <a href="#" style="text-decoration: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg"  fill="currentColor" class="bi bi-search" viewBox="0 0 16 16" id="search-icon">
                                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                                    </svg>
                                </a>
            
                                <a href="#" style="text-decoration: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg"  fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16" id="shelf-icon">
                                        <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"/>
                                    </svg>
                                </a>
            
                                <a href="#" id="writer" style="text-decoration: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg"  fill="currentColor" class="bi bi-pen-fill" viewBox="0 0 16 16" id="write-icon">
                                        <path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001"/>
                                    </svg>
                                </a>

                                <img src="{{ current_user.avatar_url }}" class="user-img" onclick="toggleMenu()">

                                <div class="sub-menu-wrap" id="subMenu">
                                    <div class="sub-menu">
                                        <div class="user-info">
                                            <img src="{{ current_user.avatar_url }}">
                                            <label for=" current_user.username "></label>
                                        </div>
                                        <hr>

                                        <a href="#" class="sub-menu-link">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                                                <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                                                <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                                            </svg>
                                            <p>โปรไฟล์</p>
                                        </a>

                                        <span href="#" class="sub-menu-link">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                                                <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                                                <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                                            </svg>
                                            <a href="{{ url_for('logout_page') }}">ออกจากระบบ</a>
                                        </span>

                                    </div>
                                </div>

                            {% endif %}

                        </div>


                    </div>

            </nav>

            <script>
                let subMenu = document.getElementById("subMenu");

                function toggleMenu() {
                    subMenu.classList.toggle("open-menu");
                }
            </script>

            <!-- Signup Form -->
            <div class="form signup">

                <div class="form-content">

                    <header style="font-size: 1.2rem;"> Sign up for a Novel Vortex account </header>

                    {% with messages = get_flashed_messages() %}
                        {% if messages %}
                            <div class="notification is-danger">
                                {{ messages[0] }}. Go to <a href="{{ url_for('login_page') }}">login page</a>.
                            </div>
                        {% endif %}
                    {% endwith %}

                    <form method="POST">

                        <div class="field input-field">
                            <div class="topic">
                                Username
                            </div>
                            <input type="text" name="username" placeholder="Username" class="input-u" style="text-transform: none;" autofocus="" required />
                        </div>

                        <div style="padding-bottom: 0.3rem;"></div>

                        <div class="field input-field email-field">
                            <div class="topic">
                                Email  
                            </div>                          
                            <input type="email" name="email" placeholder="Email" class="input-u" style="text-transform: none;" autofocus="" required />
                        </div>

                        <div style="padding-bottom: 0.3rem;"></div>

                        <div class="field input-field password" id="field">
                            
                            <div class="topic">
                                Password
                            </div>
                            <input type="password" name="password" placeholder="Enter password" class="password" style="text-transform: none;" required />
                            <i class="bx bx-hide show-hide" id="eye-icons"></i>

                            <span class="error password-error">
                                <i class="bx bx-error-circle error-icon"></i>
                                <p class="error-text">
                                    Please enter atleast 8 charatcer with number, symbol, small and
                                    capital letter.
                                </p>
                            </span>
                        </div> 

                        <div style="padding-bottom: 0.3rem;"></div>

                        <div class="field input-field confirm-password">
                            <div class="topic">
                                Confirm password
                            </div>
                            <input type="password" placeholder="Confirm your password" class="confirm_password" style="text-transform: none;" style="text-transform: none;" required />
                            <i class="bx bx-hide show-hide" id="eye-icons"></i>

                            <span class="error cfPassword-error">
                                <i class="bx bx-error-circle error-icon"></i>
                                <p class="error-text">Password don't match</p>
                            </span>
                        </div>

                        <div style="padding-bottom: 0.3rem;"></div>

                        <div class="field input-field">
                            <div class="topic">
                                Birthday
                            </div>
                            <input type="date" name="birthday" placeholder="Enter birth date" required />
                        </div>

                        <div style="padding-bottom: 1rem;"></div>

                        <div class="field button-field">
                            <button>Apply for membership</button>
                        </div>

                    </form>

                    <div style="padding-bottom: 0.5rem;"></div>

                    <div class="form-link">
                        <span>Already have an account? <a href="{{ url_for('login_page') }}" class="link login-link">Login</a></span>

                    </div>

                </div>

            </div>
            
        </div>
        

        <script>
            const   eyeIcons = document.querySelectorAll(".show-hide")
      
            // eye-icon
            eyeIcons.forEach((eyeIcon) => {
                eyeIcon.addEventListener("click", () => {
                    const pInput = eyeIcon.parentElement.querySelector("input"); //getting parent element of eye icon and selecting the password input

                    if (pInput.type === "password") {
                    eyeIcon.classList.replace("bx-hide", "bx-show");
                    return (pInput.type = "text");
                    }
                    eyeIcon.classList.replace("bx-show", "bx-hide");
                    pInput.type = "password";
                });
            });
            
            // password validation
            function usersPassword() {
                const  passwordPattern = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[~!@#$%^&*()_+-={}\[\]:;'"\\|,./?><])[A-Za-z\d~!@#$%^&*()_+-={}\[\]:;'"\\|,./?><]{8,}$/;

                if (!passwordInput.value.match(passwordPattern)) {
                    return passwordField.classList.add("invalid");
                }
                passwordField.classList.remove("invalid");
            }

            // confirm password validation
            function confirmPassword() {
                if ((passwordInput.value !== cfPassInput.value) || (cfPassInput.value === "")) {
                    return cfPassFeild.classList.add("invalid")
                }
                cfPassFeild.classList.remove("invalid");
            }

            form.addEventListener("submit", (e) => {
                e.preventDefault();
                usersPassword();
                confirmPassword();

                passwordInput.addEventListener("keyup", usersPassword);
                cfPassInput.addEventListener("keyup", confirmPassword);

                if ( !passwordField.classList.contains("invalid") && !cfPassFeild.classList.contains("invalid")) {
                    location.href = form.getAttribute("action");
                }
            });
            
        </script>

    </body>

</html>